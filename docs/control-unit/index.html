<!DOCTYPE html>
<html lang="en">

<head>
    <title>Gate-Level Control Unit Design | liu&#x27;s website</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://liu2g.github.io/style.css">
    <link rel="stylesheet" href="https://liu2g.github.io/color/green-auto.css">

        <link rel="stylesheet" href="https://liu2g.github.io/color/background_blue.css">
    
    <link rel="stylesheet" href="https://liu2g.github.io/font-hack-subset.css">

    <meta name="description" content="">

    <meta property="og:description" content="">
    <meta property="og:title" content="Gate-Level Control Unit Design | liu's website">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://liu2g.github.io/control-unit/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="Gate-Level Control Unit Design | liu's website">
    <meta property="twitter:domain" content="liu2g.github.io">
    <meta property="twitter:url" content="https://liu2g.github.io/control-unit/">

        <link rel="shortcut icon" type="image/png" href="/favicon.png">
    

<link rel="stylesheet" href="https://liu2g.github.io/katex.css">
<script defer src="https://liu2g.github.io/katex.js"></script>
<script defer src="https://liu2g.github.io/auto-render.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
              {left: "$$", right: "$$", display: true},
              {left: "$", right: "$", display: false},
            ]
        });
    });
</script>

</head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://liu2g.github.io" style="text-decoration: none;">
                    <div class="logo">
                      
                            liu
                        
                    </div>
                </a>
            </div>
        </div>

        
        <nav class="menu">
            <ul class="menu__inner">
                <li><a href="https://liu2g.github.io/about">about me</a></li>
            
                <li><a href="https://github.com/liu2g/resume/releases/latest" target="_blank" rel="noopener noreferrer">resume</a></li>
            
                <li><a href="https://liu2g.github.io/projects">projects</a></li>
            
                <li><a href="https://liu2g.github.io/tags">tags</a></li>
            
                <li><a href="https://github.com/liu2g" target="_blank" rel="noopener noreferrer">    <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em"
        viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M10.9,2.1c-4.6,0.5-8.3,4.2-8.8,8.7c-0.5,4.7,2.2,8.9,6.3,10.5C8.7,21.4,9,21.2,9,20.8v-1.6c0,0-0.4,0.1-0.9,0.1 c-1.4,0-2-1.2-2.1-1.9c-0.1-0.4-0.3-0.7-0.6-1C5.1,16.3,5,16.3,5,16.2C5,16,5.3,16,5.4,16c0.6,0,1.1,0.7,1.3,1c0.5,0.8,1.1,1,1.4,1 c0.4,0,0.7-0.1,0.9-0.2c0.1-0.7,0.4-1.4,1-1.8c-2.3-0.5-4-1.8-4-4c0-1.1,0.5-2.2,1.2-3C7.1,8.8,7,8.3,7,7.6c0-0.4,0-0.9,0.2-1.3 C7.2,6.1,7.4,6,7.5,6c0,0,0.1,0,0.1,0C8.1,6.1,9.1,6.4,10,7.3C10.6,7.1,11.3,7,12,7s1.4,0.1,2,0.3c0.9-0.9,2-1.2,2.5-1.3 c0,0,0.1,0,0.1,0c0.2,0,0.3,0.1,0.4,0.3C17,6.7,17,7.2,17,7.6c0,0.8-0.1,1.2-0.2,1.4c0.7,0.8,1.2,1.8,1.2,3c0,2.2-1.7,3.5-4,4 c0.6,0.5,1,1.4,1,2.3v2.6c0,0.3,0.3,0.6,0.7,0.5c3.7-1.5,6.3-5.1,6.3-9.3C22,6.1,16.9,1.4,10.9,2.1z" ></path>
    </svg>
    </a></li>
            
                <li><a href="https://gitlab.com/liu2g" target="_blank" rel="noopener noreferrer">    <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em"
        viewBox="0 0 50 50" fill="none" stroke="currentColor">
            <path d="M 38.011719 4 C 37.574219 3.996094 37.183594 4.273438 37.046875 4.691406 L 32.074219 20 L 17.925781 20 L 12.953125 4.691406 C 12.820313 4.289063 12.449219 4.011719 12.023438 4 C 11.597656 3.992188 11.214844 4.25 11.0625 4.648438 L 5.070313 20.640625 C 5.066406 20.640625 5.066406 20.644531 5.0625 20.648438 L 2.0625 28.648438 C 1.90625 29.070313 2.046875 29.542969 2.414063 29.808594 L 24.40625 45.800781 L 24.410156 45.808594 C 24.414063 45.808594 24.414063 45.808594 24.414063 45.8125 C 24.425781 45.820313 24.441406 45.828125 24.453125 45.835938 C 24.46875 45.84375 24.480469 45.855469 24.496094 45.863281 C 24.5 45.863281 24.5 45.867188 24.503906 45.867188 C 24.503906 45.867188 24.507813 45.871094 24.511719 45.871094 C 24.515625 45.875 24.519531 45.878906 24.527344 45.878906 C 24.53125 45.882813 24.539063 45.886719 24.542969 45.890625 C 24.5625 45.898438 24.585938 45.910156 24.609375 45.917969 C 24.609375 45.917969 24.609375 45.917969 24.609375 45.921875 C 24.632813 45.929688 24.65625 45.9375 24.675781 45.945313 C 24.679688 45.945313 24.679688 45.945313 24.683594 45.949219 C 24.699219 45.953125 24.714844 45.957031 24.734375 45.964844 C 24.742188 45.964844 24.75 45.96875 24.761719 45.96875 C 24.761719 45.972656 24.761719 45.972656 24.761719 45.96875 C 24.78125 45.976563 24.800781 45.980469 24.820313 45.984375 C 24.847656 45.988281 24.871094 45.992188 24.898438 45.996094 C 24.9375 45.996094 24.980469 46 25.019531 46 C 25.058594 45.996094 25.09375 45.996094 25.128906 45.988281 C 25.144531 45.988281 25.15625 45.988281 25.171875 45.984375 C 25.171875 45.984375 25.175781 45.984375 25.179688 45.984375 C 25.1875 45.980469 25.191406 45.980469 25.199219 45.980469 C 25.203125 45.980469 25.207031 45.976563 25.214844 45.976563 C 25.222656 45.972656 25.234375 45.972656 25.242188 45.96875 C 25.257813 45.964844 25.269531 45.960938 25.28125 45.957031 C 25.289063 45.957031 25.292969 45.957031 25.296875 45.953125 C 25.300781 45.953125 25.304688 45.953125 25.308594 45.953125 C 25.324219 45.945313 25.34375 45.9375 25.359375 45.933594 C 25.378906 45.925781 25.394531 45.917969 25.410156 45.910156 C 25.414063 45.910156 25.414063 45.910156 25.417969 45.90625 C 25.421875 45.90625 25.425781 45.90625 25.429688 45.902344 C 25.4375 45.898438 25.445313 45.894531 25.453125 45.890625 C 25.476563 45.878906 25.496094 45.867188 25.515625 45.855469 C 25.523438 45.851563 25.527344 45.847656 25.53125 45.84375 C 25.535156 45.84375 25.539063 45.839844 25.542969 45.839844 C 25.558594 45.828125 25.574219 45.820313 25.589844 45.808594 L 25.597656 45.796875 L 47.589844 29.808594 C 47.953125 29.542969 48.09375 29.070313 47.9375 28.648438 L 44.945313 20.675781 C 44.941406 20.667969 44.9375 20.65625 44.9375 20.648438 L 38.9375 4.648438 C 38.789063 4.261719 38.425781 4.003906 38.011719 4 Z M 11.933594 8.027344 L 15.824219 20 L 7.445313 20 Z M 38.066406 8.027344 L 42.558594 20 L 34.175781 20 Z M 8.066406 22 L 16.472656 22 L 22.328125 40.015625 Z M 18.578125 22 L 31.421875 22 L 25 41.765625 Z M 33.527344 22 L 41.933594 22 L 27.671875 40.015625 Z M 6.3125 23.007813 L 19.6875 39.902344 L 4.203125 28.640625 Z M 43.6875 23.007813 L 45.796875 28.640625 L 30.3125 39.902344 Z"></path>
    </svg>
    </a></li>
            
                <li><a href="https://www.linkedin.com/in/liu2g" target="_blank" rel="noopener noreferrer">    <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em"
        viewBox="0 0 30 30" fill="none" stroke="currentColor">
            <path d="M24,4H6C4.895,4,4,4.895,4,6v18c0,1.105,0.895,2,2,2h18c1.105,0,2-0.895,2-2V6C26,4.895,25.105,4,24,4z M10.954,22h-2.95 v-9.492h2.95V22z M9.449,11.151c-0.951,0-1.72-0.771-1.72-1.72c0-0.949,0.77-1.719,1.72-1.719c0.948,0,1.719,0.771,1.719,1.719 C11.168,10.38,10.397,11.151,9.449,11.151z M22.004,22h-2.948v-4.616c0-1.101-0.02-2.517-1.533-2.517 c-1.535,0-1.771,1.199-1.771,2.437V22h-2.948v-9.492h2.83v1.297h0.04c0.394-0.746,1.356-1.533,2.791-1.533 c2.987,0,3.539,1.966,3.539,4.522V22z"></path>
    </svg>
    </a></li>
            
                <li><a href="mailto:leo85811nardo@protonmail.com" target="_blank" rel="noopener noreferrer">    <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em"
        viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
    </svg>
    </a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://liu2g.github.io/control-unit/">Gate-Level Control Unit Design</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2021-04-26
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://liu2g.github.io/tags/class-project/">#class-project</a>&nbsp;
                <a class="post-tag" href="https://liu2g.github.io/tags/electronic-systems/">#electronic-systems</a></span>
    

        <div class="post-content">
            <p>This article talks about the technical aspects and takeaway from two
inter-connecting projects from Intro to Computer Architecture and Organization
Class. The detail about the class is explained in my <a href="../Discussion/spring-2021.md">Spring 2021
Remark</a>. More info about the projects is available
at my <a href="https://github.com/liu2g/school-files/tree/main/spring2021-comp-org">school-files
repo</a>.</p>
<h3 id="non-pipelined-control-unit">Non-Pipelined Control Unit</h3>
<p>A single-bus processing unit was designed capable of executing a set of
instructions specified as in Fig. 1. The design was implemented at the gate
level. Some restrictions of the assignment include:</p>
<ul>
<li>Design should be restricted to single-bus paradigm. No point-to-point connections.</li>
<li>Read-only memory (ROM) may be used to contain up to 8 constants. Its design
can be specified descriptively.</li>
<li>Main memory (MM) design can be specified descriptively and performs asynchronously</li>
<li>Gate level design must only use MUX, DEMUX, encoder, decoder, flip-flop and gates.</li>
<li>Detailed count-down timer design can be specified descriptively.</li>
</ul>
<figure>
  <img src="instr-table.png"/>
  <figcaption> <small> Fig. 1: Instruction set </small> </figcaption>
</figure>
<h4 id="solution-brief">Solution Brief</h4>
<p>We presented our design in a modular structure, which of which is used
extensively by the CPU to meet the design requirements and achieve optimization.
An abstract overview of the CPU is shown in Fig. 2. Data used in the
instructions is pushed to a 16-bit bus as the only conveyance before being
delivered to the intended locations.</p>
<figure>
  <img src="data-path.png"/>
  <figcaption> <small> Fig. 2: Abstract view of the data path </small> </figcaption>
</figure>
<p>We started the Control Unit design by firstly defining the control signals
needed in each instructions, during which we also discussed necessary changes
and possible optimizations in the data path. The common fetch-decode-execute
sequence was adopted as a general guideline. Afterwards, the control signals are
collapsed into groups such that states can be determined, as well as the state
transition. With the aforementioned state information narrowed down, the
gate-level circuit was implemented as a Moore machine whose input is Opcode and
various control flags from other components on the data bus, and whose output is
to enable tri-state buffers on data paths.</p>
<figure>
  <img src="state-trans.png"/>
  <figcaption> <small> Fig. 3: State transition diagram </small> </figcaption>
</figure>
<figure>
  <img src="control-unit.png"/>
  <figcaption> <small> Fig. 4: Control unit block component view </small> </figcaption>
</figure>
<p>Detail on other components is explained in the <a href="https://github.com/liu2g/school-files/tree/main/fall2021-comp-org/project-3-report.pdf">project report</a>. Related optimizations include:</p>
<ul>
<li>We use Y and Z as pre- and post- buffer for the ALU operations, respectively,
by statically writing in common register values.</li>
<li>Insead of sending six different control signals to dictate ALU functions for
Opcode 0-5, whose operands are in similar format, the control unit commences a
master signal which lets the ALU requests the Opcode directly to decide on the
specific logical/arithmetic operations.</li>
<li>The ALU utilizes a carry lookahead adder-subtractor circuit in order to add or
subtract two 16-bit values and output a single 16-bit value. The carry
lookahead generator, while it utilizes more gates than the ripple-carry adder
design, results in a significant decrease in propagation delay and performance
time through the operations.</li>
</ul>
<figure>
  <img src="data-path-block.png"/>
  <figcaption> <small> Fig 5: Data path block diagram </small> </figcaption>
</figure>
<h4 id="takeaway">Takeaway</h4>
<p>In this project, we went through the design and part of the implementation phase
of a digital/register level project. We broke down the specification, explored
possible solution, discussed possible optimization and eventually documented our
solution within the time constraints. As a class assignment, we have scored the
highest grade with a few points taken off due to formatting inconsistency. The
project also gave us a chance to reflect on our understanding of the material,
and luckily we were given enough time to clarify some questions over the
discussion of the project.</p>
<h3 id="pipelined-control-unit">Pipelined Control Unit</h3>
<p>In this project, we were assigned to design a CPU with almost the same
functionality, except the operation can be pipelined, and that the gate-level
implementation is not required. Other limitations include I/O constraints,
register space capacity, etc, are listed below.</p>
<ul>
<li>No hard restriction on data path, but all paths should be used reasonably.</li>
<li>Main memory (MM) has separate instruction and data ports that can be used
simultaneously.</li>
<li>Register file (GPR) has 3 read ports and 2 write ports and all can be accessed
simultaneously.</li>
<li>The pipeline should include at least three stages, corresponding to the
fetch/decode/execute cycle.</li>
<li>Read-only memory (ROM) may be used to contain up to 8 constants.</li>
</ul>
<h4 id="solution-brief-1">Solution Brief</h4>
<p>As the functionality of this machine has many parts that overlap with the
previous project, the detailed design and implementation were only briefly
covered, whereas the pipeline is mainly discussed in the solution.</p>
<p>Our pipeline design consists of four unique stages: F1, F2, D1 and E1, matching
the fetch/decode/execute cycle instruction cycle (Figure 6). Although some
states share hardware resources, each has its own portion of the data path and
dedicated portion of the control unit. By this design, each state only uses 1
clock cycle to finish, resulting in an ideal instruction completion time of 4
clock cycles - with a possible 4 instructions in the pipeline. Though it was
hard to implement such system, this was a firm decision we made at the very
beginning and we were determined to resolve the hazards from it.</p>
<figure>
  <img src="pipeline-timing.png"/>
  <figcaption> <small> Fig. 6: Four stage pipeline </small> </figcaption>
</figure>
<p>Before we decipher the hazards individually, we designed a hardware queue system
that dispatches instruction register (IR) and PC data to each stages, ensuring
the correct flow of the pipeline. The implementation of the queuing on IR and PC
is 16 stacks of 4-bit and 3-bit shift registers, respectively, shown in Fig. 7.
The memory organization of them can be seen in Fig. 8, where each row is a shift
register that can be controlled to shift, keep, or clear on each element,
whereas a column represents a full IR/PC data. Additionally, by having a
digitally controlled buffer from the clock to the RESET of the flip-flops, the
register can also be cleared synchronously with the rest of the machine.</p>
<figure>
  <img src="q-mem-org.png"/>
  <figcaption> <small> Fig. 7: Memory organization of the queues </small> </figcaption>
</figure>
<figure>
  <img src="shift-reg.png"/>
  <figcaption> <small> Fig. 8: Partial demonstration of shift register control </small> </figcaption>
</figure>
<p>Thus, to reflect this queue transition, the control unit commences command for
various event during runtime. The control unit on the top level is demonstrated
in Fig. 9.</p>
<figure>
  <img src="pipeline-control-unit.png"/>
  <figcaption> <small> Fig. 9: Control unit top level design </small> </figcaption>
</figure>
<p>The Stage Controller enables and disables the stages of the pipeline. The Queue
Controller keeps the queue in synchronization with the stage behavior by moving
forward the shift registers. At this level, the machine can be seen repeating on
a normal state so long as there are no hazards or exceptions. In the event when
they appear, the control unit enters states where it resolves the issue, then go
back to looping state. These states are listed in Fig. 10, along with the GO
state when the machine operates normally. The table also specifies whether to
enable specific stages and the control over the queue, which will be justified
in sections on hazards and exceptions.</p>
<figure>
  <img src="pipeline-states.png"/>
  <figcaption> <small> Fig. 10: States </small> </figcaption>
</figure>
<p>Structural hazards, data hazards and control hazards are addressed separately.
The main idea in our solution is stalling, or descriptively, prioritize
execution (E1), and keep other stages from moving, until the hazard is
unflagged. The analysis of each can be found in the project report. A summary is
we exhaust all possible hazards, determined the true conditions, such that the
implementation could be as simple as combinatorial gates. As for control
hazards, we were well aware that a dynamic branch predictor is more popular and
normally more efficient. However, since the data path design is determined
before considering the control hazards, a limitation is placed to only update PC
at execution (E1), making it ineffective even if the predictor predicts “taken”.
Thus, it was decided to use a branch predictor that statically predicts “not
taken”.</p>
<figure>
  <img src="hazard-timing.png"/>
  <figcaption> <small> Fig. 11: Hazard delay example </small> </figcaption>
</figure>
<h4 id="takeaway-1">Takeaway</h4>
<p>Compared to the previous assignment, though not requiring a gate-level
implementation, this project was more analytically challenging for us as it
requires deeper and applicable understanding of pipeline design. Plus, we also
decided on a even more ambitious goal of only allows one step in each stage.
Luckily, with the collective effort of trials and errors, we were able to make
sense of everything and deliver the project in time.</p>
<p>Continuing the project, though not required as an assignment, we hope with
capable hardware such as FPGA, we could actually implement both machines to
reality.</p>

        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">See more projects</span>
                    <hr />
                </div>
                <div class="pagination__buttons">
                        <span class="button previous">
                            <a href="https://liu2g.github.io/gastrack/">
                                <span class="button__icon">←</span>&nbsp;
                                <span class="button__text">Developing a Gas Price Tracking and Prediction Application</span>
                            </a>
                        </span>
                    
                    
                        <span class="button next">
                            <a href="https://liu2g.github.io/mgms/">
                                <span class="button__text">Modular Garden Monitoring System (Senior Design Project)</span>&nbsp;
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    </div>
            </div>
        
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright copyright--user">Licensed under&nbsp;<a rel="license nofollow noopener noreferrer"
    href="https://creativecommons.org/licenses/by/4.0/" target="_blank">
    CC-BY-4.0</a></div>
            </div>
    </footer>
    

</div>
</body>

</html>
